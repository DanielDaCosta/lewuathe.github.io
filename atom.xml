<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[The first cry of Atom]]></title>
  <link href="http://lewuathe.github.io/atom.xml" rel="self"/>
  <link href="http://lewuathe.github.io/"/>
  <updated>2014-03-09T20:22:04+09:00</updated>
  <id>http://lewuathe.github.io/</id>
  <author>
    <name><![CDATA[Kai Sasaki]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Logistics Regression With Sparse Vector]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/09/logistics-regression-with-sparse-vector/"/>
    <updated>2014-03-09T19:54:25+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/09/logistics-regression-with-sparse-vector</id>
    <content type="html"><![CDATA[<p>In my project I have to develop a model that is capable of predicting the count of page view
from sparse vector data such as</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
</span><span class='line'> 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]</span></code></pre></td></tr></table></div></figure>


<p>However I found it was difficult to make a model which can be in practical use. From sparse vector, my current model
is not trained sufficiently. I used <a href="http://scikit-learn.org/stable/index.html">scikit-learn</a> in python.</p>

<!-- more -->


<p>My current code is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">random</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
</span><span class='line'>    <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Train&quot;</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
</span><span class='line'>      <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">      x is a sparse vector generated from binomial distribution</span>
</span><span class='line'><span class="sd">      x has a 1 vector generally speaking</span>
</span><span class='line'><span class="sd">     &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="n">x</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span><span class='line'>        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="sd">&quot;&quot;&quot;</span>
</span><span class='line'><span class="sd">      y is obtained from gaussian distribution which has 0.7 as mean value</span>
</span><span class='line'><span class="sd">        &quot;&quot;&quot;</span>
</span><span class='line'>        <span class="n">y</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">clf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVR</span><span class="p">()</span>
</span><span class='line'>  <span class="c"># Train data</span>
</span><span class='line'>    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="s">&quot;Test&quot;</span>
</span><span class='line'>    <span class="n">ts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
</span><span class='line'>        <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">print</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Through this process I can only get these results.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">[</span> <span class="mf">0.7507838</span>   <span class="mf">0.7507838</span>   <span class="mf">0.75058871</span>  <span class="mf">0.7507838</span>   <span class="mf">0.75058871</span>  <span class="mf">0.75058871</span>
</span><span class='line'>  <span class="mf">0.73136874</span>  <span class="mf">0.7507838</span>   <span class="mf">0.75058871</span>  <span class="mf">0.75058871</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think this result doesn&rsquo;t have valid significance for predicting. All values look the same to me!
Simple support vector machine might not be suitable to predict with sparse vector data. But I have no idea
how to make alternate model that can be constructed with sparse vectors. Is there anyone who have a good idea or
a paper which has proper algorithm for this case? I want to know the algorithm which can construct better regression
model from sparse vector. Please let me know that.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Memento Pattern in Java]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/08/memento-pattern-in-java/"/>
    <updated>2014-03-08T00:02:29+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/08/memento-pattern-in-java</id>
    <content type="html"><![CDATA[<p>Recently, I implemented some design patterns following <a href="http://www.amazon.co.jp/%E5%A2%97%E8%A3%9C%E6%94%B9%E8%A8%82%E7%89%88Java%E8%A8%80%E8%AA%9E%E3%81%A7%E5%AD%A6%E3%81%B6%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E5%85%A5%E9%96%80-%E7%B5%90%E5%9F%8E-%E6%B5%A9/dp/4797327030">this book</a>. This book introduces 23 design patterns that all programmers should know when you write according to OOP instructions. So now I want to write this article about some of these patterns and explain these. All codes that used in this article are put <a href="https://github.com/Lewuathe/java-GoF/tree/master/Memento">here</a></p>

<!-- more -->


<h2>What is Memento pattern?</h2>

<p>Memento pattern is used for recording past statuses and for recovering susequently. For example when you use text editor such as vim or emacs, do you use <code>undo</code>?
Why do you think this <code>undo</code> command can perform? As one way, all statuses(sometimes not all) are recorded as a type of object. Then you can recover this object
to use this recovered data in your application. Let&rsquo;s picking up game example, examine the structure of memento pattern.</p>

<h2>Main</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">game.Gamer</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">game.Memento</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Gamer</span> <span class="n">gamer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gamer</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Memento</span> <span class="n">memento</span> <span class="o">=</span> <span class="n">gamer</span><span class="o">.</span><span class="na">createMemento</span><span class="o">();</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;=== &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Current: &quot;</span> <span class="o">+</span> <span class="n">gamer</span><span class="o">);</span>
</span><span class='line'>            <span class="n">gamer</span><span class="o">.</span><span class="na">bet</span><span class="o">();</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Money: ¥&quot;</span> <span class="o">+</span> <span class="n">gamer</span><span class="o">.</span><span class="na">getMoney</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="o">(</span><span class="n">gamer</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">memento</span><span class="o">.</span><span class="na">getMoney</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Save current state&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="n">memento</span> <span class="o">=</span> <span class="n">gamer</span><span class="o">.</span><span class="na">createMemento</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">gamer</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">memento</span><span class="o">.</span><span class="na">getMoney</span><span class="o">()</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Restore previous state&quot;</span><span class="o">);</span>
</span><span class='line'>                <span class="n">gamer</span><span class="o">.</span><span class="na">restoreMemento</span><span class="o">(</span><span class="n">memento</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>On every turn, a gamer bets and gets money or some fruits. If you get more money at the last of game you win. It&rsquo;s very simple.
Please pay attention to line 7. Mement pattern is used there. This memento object is used when gamer can get more money or reduce
his money to half of previous one. For saving, call <code>gamer.createMemento()</code> and for restoring, call <code>gamer.restoreMemento()</code>.
All concepts that are included in memento pattern are these. It is easy to understand this pattern. Do you think you can write this pattern
in your production code tomorrow? Please try it.</p>

<p>As a reference, memento class is also placed here. But it is not core concept of memento pattern. You can arrange this concrete logic for your use
if you could only save and restore statuses.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">game</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Memento</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">money</span><span class="o">;</span>
</span><span class='line'>    <span class="n">ArrayList</span> <span class="n">fruits</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMoney</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">money</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Memento</span><span class="o">(</span><span class="kt">int</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">money</span> <span class="o">=</span> <span class="n">money</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">fruits</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">addFruit</span><span class="o">(</span><span class="n">String</span> <span class="n">fruit</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">fruits</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fruit</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="n">List</span> <span class="nf">getFruits</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="o">(</span><span class="n">List</span><span class="o">)</span><span class="n">fruits</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is there any unclear stuff? Please look into <a href="https://github.com/Lewuathe/java-GoF/tree/master/Memento">this codes</a>.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How Is HashMap Written in Java]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/06/how-is-hashtable-written-in-java/"/>
    <updated>2014-03-06T22:22:04+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/06/how-is-hashtable-written-in-java</id>
    <content type="html"><![CDATA[<p>Here recently, I have a chance to read Java core API, expecially <em>HashMap</em>.
Usually, I use HashMap paying no attention to, but this code reading brought many things to me.
I can understand that how HashMap is written in Java and more this is very simple than I expected.
So in this post, I&rsquo;d like to introduce some ideas and code used in <code>java.util.HashMap</code>.</p>

<!-- more -->


<h2>Constructor</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractMap</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="kd">implements</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;,</span> <span class="n">Cloneable</span><span class="o">,</span> <span class="n">Serializable</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">HashMap</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// DEFAULT_INITIAL_CAPACITY is 16</span>
</span><span class='line'>      <span class="c1">// DEFAULT_LOAD_FACTOR is 0.75f</span>
</span><span class='line'>      <span class="k">this</span><span class="o">(</span><span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">,</span> <span class="n">DEFAULT_LOAD_FACTOR</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is <code>HashMap</code> constructor. <code>DEFAULT_INITIAL_CAPACITY</code> is the default size of array. This value is set as below.
<code>DEFAULT_LOAD_FACTOR</code> is the ratio of the number of put items to maximum capacity of hash table. Default value is 0.75f.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="o">;</span> <span class="c1">// aka 16</span>
</span></code></pre></td></tr></table></div></figure>


<p>Only 16 items can be retained in HashMap. What happen if this size become insufficient for your use?
In every code of adding item, this line was added.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="k">if</span> <span class="o">((</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">]))</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">resize</span><span class="o">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>    <span class="n">hash</span> <span class="o">=</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">key</span><span class="o">)</span> <span class="o">?</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="n">bucketIndex</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Threshold means the next size to which this table will resized. So if there are more items than an array can keep,
array is resized by <code>resize</code> and hash value is calculated based on the new table size. <code>resize</code> is defined as below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">newCapacity</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Entry</span><span class="o">[]</span> <span class="n">oldTable</span> <span class="o">=</span> <span class="n">table</span><span class="o">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">oldCapacity</span> <span class="o">=</span> <span class="n">oldTable</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">oldCapacity</span> <span class="o">==</span> <span class="n">MAXIMUM_CAPACITY</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="c1">// Setting next size to max</span>
</span><span class='line'>        <span class="n">threshold</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span>
</span><span class='line'>        <span class="k">return</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Entry</span><span class="o">[]</span> <span class="n">newTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">[</span><span class="n">newCapacity</span><span class="o">];</span>
</span><span class='line'>  <span class="c1">// move all items to new hash table</span>
</span><span class='line'>    <span class="n">transfer</span><span class="o">(</span><span class="n">newTable</span><span class="o">,</span> <span class="n">initHashSeedAsNeeded</span><span class="o">(</span><span class="n">newCapacity</span><span class="o">));</span>
</span><span class='line'>    <span class="n">table</span> <span class="o">=</span> <span class="n">newTable</span><span class="o">;</span>
</span><span class='line'>    <span class="n">threshold</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">newCapacity</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="o">,</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Create new table, and transfer all items to new table. It is simple, isn&rsquo;t it?
So keep going to <code>put</code>. the core algorithm of this method is hashing key.</p>

<h2>Put</h2>

<p>Put code is written as below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">V</span> <span class="nf">put</span><span class="o">(</span><span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">table</span> <span class="o">==</span> <span class="n">EMPTY_TABLE</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">inflateTable</span><span class="o">(</span><span class="n">threshold</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span><span class='line'>       <span class="k">return</span> <span class="nf">putForNullKey</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span><span class='line'>  <span class="c1">// Get hash value of this key object</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>  <span class="c1">// Get index in the hash table, so called bucket</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>     <span class="c1">// Search the item that has same key object</span>
</span><span class='line'>       <span class="n">Object</span> <span class="n">k</span><span class="o">;</span>
</span><span class='line'>       <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">)))</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
</span><span class='line'>          <span class="n">e</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>          <span class="n">e</span><span class="o">.</span><span class="na">recordAccess</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
</span><span class='line'>       <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// If there no item that match the given key, create new entry.</span>
</span><span class='line'>    <span class="n">modCount</span><span class="o">++;</span>
</span><span class='line'>    <span class="n">addEntry</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If table is not created yet, make it by using <code>inflateTable</code>. Then hasing with <code>hash</code>. <code>hash</code> is defined as below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="kt">int</span> <span class="nf">hash</span><span class="o">(</span><span class="n">Object</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">hashSeed</span><span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="mi">0</span> <span class="o">!=</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">Hashing</span><span class="o">.</span><span class="na">stringHash32</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">k</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">h</span> <span class="o">^=</span> <span class="n">k</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// This function ensures that hashCodes that differ only by</span>
</span><span class='line'>    <span class="c1">// constant multiples at each bit position have a bounded</span>
</span><span class='line'>    <span class="c1">// number of collisions (approximately 8 at default load factor).</span>
</span><span class='line'>    <span class="n">h</span> <span class="o">^=</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">20</span><span class="o">)</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">12</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">h</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">7</span><span class="o">)</span> <span class="o">^</span> <span class="o">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the key object is <code>String</code>, <code>sum.misc.Hashing.stringHash32</code> is used as hashing algorithm. In the other case, make use of <code>Object.hashCode()</code>.
This method is declared in <code>Object</code> class. So all objects in Java should implements this method or defined already super classes.
In both cases, <code>k.hashCode()</code> can be called safely. In order to make sure that hash value is unique in hash table, some bit calculations
are operated on <code>h</code>. So now, you can get hash value correspond to key object.</p>

<p>Please pay attention to the data structure used for storing items. This is implemented as chaining pattern.
Back to <code>put</code> method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'><span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">i</span><span class="o">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Object</span> <span class="n">k</span><span class="o">;</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">)))</span> <span class="o">{</span>
</span><span class='line'>       <span class="n">V</span> <span class="n">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>       <span class="n">e</span><span class="o">.</span><span class="na">recordAccess</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span><span class='line'>       <span class="k">return</span> <span class="n">oldValue</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">modCount</span><span class="o">++;</span>
</span><span class='line'><span class="n">addEntry</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'><span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After getting index for hash value with <code>indexFor(hash, table.length)</code>, take a chain from correspond bucket item.
<code>table[i]</code> is the first item of this linked list. In the case of existing the value which has same key, update value.
If there are overlapped items in this table, linked list has multiple items. To reduce calculation cost, new item is prepend to this list in <code>addEntry</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">void</span> <span class="nf">addEntry</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">bucketIndex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">((</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">]))</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">resize</span><span class="o">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>        <span class="n">hash</span> <span class="o">=</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">key</span><span class="o">)</span> <span class="o">?</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>        <span class="n">bucketIndex</span> <span class="o">=</span> <span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">createEntry</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">bucketIndex</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>createEntry</code> prepends this put value.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kt">void</span> <span class="nf">createEntry</span><span class="o">(</span><span class="kt">int</span> <span class="n">hash</span><span class="o">,</span> <span class="n">K</span> <span class="n">key</span><span class="o">,</span> <span class="n">V</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">bucketIndex</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">];</span>
</span><span class='line'>  <span class="c1">// hash: hash value that belongs to new entry</span>
</span><span class='line'>  <span class="c1">// key: key object that belongs to new entry</span>
</span><span class='line'>  <span class="c1">// value: content value that belongs to new entry</span>
</span><span class='line'>  <span class="c1">// e: next node that is append to new entry item</span>
</span><span class='line'>    <span class="n">table</span><span class="o">[</span><span class="n">bucketIndex</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">&lt;&gt;(</span><span class="n">hash</span><span class="o">,</span> <span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class='line'>    <span class="n">size</span><span class="o">++;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>Entry</code> constructor receives its hash value, key value, content value and next node for linked list.
So in this line, new object which is put on the hash table is prepend to the line of linked list.
It will be the first object of the list.</p>

<h2>Get</h2>

<p>When you want to get target item that is correspond to your key, how is it works?</p>

<p>Now, <code>getEntry</code> is called.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">final</span> <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">getEntry</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>       <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">int</span> <span class="n">hash</span> <span class="o">=</span> <span class="o">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">hash</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="o">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">table</span><span class="o">[</span><span class="n">indexFor</span><span class="o">(</span><span class="n">hash</span><span class="o">,</span> <span class="n">table</span><span class="o">.</span><span class="na">length</span><span class="o">)];</span>
</span><span class='line'>      <span class="c1">// Search through linked list</span>
</span><span class='line'>        <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Object</span> <span class="n">k</span><span class="o">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">key</span><span class="o">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="o">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">k</span><span class="o">))))</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">e</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Under given key, this code do linear search through linear list in the bucket item. Inside the list,
returns the item which matches a given key object. This is simpler than I expected, but thanks to this code
I can understand how <code>HashMap</code> works in Java programming language.</p>

<p>This code reading is so fun to me that I want to keep this activity as possible.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[TopCoder With IntelliJ IDEA]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/03/topcoder-with-intellij-idea/"/>
    <updated>2014-03-03T21:45:57+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/03/topcoder-with-intellij-idea</id>
    <content type="html"><![CDATA[<p>When you try <a href="http://www.topcoder.com/">TopCoder</a>, as you know, IDE is one of the most efficient options
to write accurate code very fast. So far, <a href="https://www.eclipse.org/">Eclipse</a> is the most famous IDE in this field.
However today, I know <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> can also be the great editor to fight it out.
So I try to install TopCoder plugin into my IntelliJ IDEA which is called <a href="https://github.com/fadeyev/intellijcoder">IntelliJCoder</a>.</p>

<!-- more -->


<h2>Install</h2>

<p>By using plugin manager embedded to IntelliJ IDEA, you install IntelliJCoder. Today, its version is v1.6.
And restart your IDE.</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/plugin_install.png" alt="plugin_install" /></p>

<h2>Launch Arena</h2>

<p><img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/topcoder_icon.png" alt="plugin_install" /></p>

<p>You can see TopCoder icon inside the toolbar. If you cannot see toolbar itself, click view menu and select toolbar.
Click this icon, and TopCoder arena will be launched. It might takes some minutes.</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/toolbar.png" alt="toolbar" />
<img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/launch_arena.png" alt="launch_arena" /></p>

<h2>Open problems</h2>

<p>Ok now, let&rsquo;s solve any problems. In the proactive room, select one problem as you like from SRM.
Select problem, then you can see TopCoder simple editor. If you use any language except for Java, you should select Java.
And sckelton codes are written into your IntelliJ IDEA automatically. Now it&rsquo;s the time to solve problem. Hack it!</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/open_problem.png" alt="open_problem" /></p>

<h2>Test and Submit</h2>

<p>Suprisingly, you can also run test codes generated from this plugin. When you build this code in IntelliJ IDEA, the test codes based on problem examples
are run. So it is easy to confirm whether your code are correct or not before submitting it.
Compiling and Submitting is the same way to ordinary one. Definitely you can solve problems faster than your rivals with this plugin.</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-03-03-intellijcoder/run_test.png" alt="run_test" /></p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Object Handler Cannot Be Called in Php Extension]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/02/oobject-handler-cannot-be-called-in-php-extension/"/>
    <updated>2014-03-02T00:38:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/02/oobject-handler-cannot-be-called-in-php-extension</id>
    <content type="html"><![CDATA[<p>I have a problem.</p>

<p><a href="http://stackoverflow.com/questions/22113672/object-handler-cannot-be-called-in-php-extension">object handler cannot be called in php extension</a></p>

<p>I am developing PHP extension. However, I am not sufficient familiar with PHP extension.
So in this time, I have no answer how to solve this problem by myself.</p>

<!-- more -->


<p>I cannot call destructor of my class written in C++(in below code, <code>foo</code> is that. In my inspection, I know PHP_MINIT_FUNCTION was called definitely. Inside of PHP_MINIT_FUNCTION, set code for create_object might not be done properly. When deleting foo, foo_free_strage should be called, but not called.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">static</span> <span class="nx">zend_class_entry</span><span class="o">*</span> <span class="nx">foo_ce</span><span class="p">;</span>
</span><span class='line'><span class="k">static</span> <span class="nx">zend_object_handlers</span> <span class="nx">foo_object_handlers</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nx">void</span> <span class="nx">foo_free_storage</span><span class="p">(</span><span class="nx">void</span> <span class="o">*</span><span class="nx">object</span> <span class="nx">TSRMLS_DC</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nx">std</span><span class="o">::</span><span class="na">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;php_foo destracter&quot;</span> <span class="o">&lt;&lt;</span> <span class="nx">std</span><span class="o">::</span><span class="na">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">foo_object</span><span class="o">*</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">(</span><span class="nx">foo_object</span><span class="o">*</span><span class="p">)</span><span class="nx">object</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">delete</span> <span class="nx">obj</span><span class="o">-&gt;</span><span class="na">foo_pointer</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">efree</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">zend_object_value</span> <span class="nx">foo_create_handler</span><span class="p">(</span><span class="nx">zend_class_entry</span> <span class="o">*</span><span class="nx">type</span> <span class="nx">TSRMLS_DC</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nx">std</span><span class="o">::</span><span class="na">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;php_foo handler&quot;</span> <span class="o">&lt;&lt;</span> <span class="nx">std</span><span class="o">::</span><span class="na">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">zval</span> <span class="o">*</span><span class="nx">tmp</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">zend_object_value</span> <span class="nx">retval</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">foo_object</span> <span class="o">*</span><span class="nx">obj</span> <span class="o">=</span> <span class="p">(</span><span class="nx">foo_object</span> <span class="o">*</span><span class="p">)</span><span class="nx">emalloc</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nx">foo_object</span><span class="p">));</span>
</span><span class='line'>  <span class="nx">memset</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nx">foo_object</span><span class="p">));</span>
</span><span class='line'>  <span class="nx">obj</span><span class="o">-&gt;</span><span class="na">std</span><span class="o">.</span><span class="nx">ce</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">retval</span><span class="o">.</span><span class="nx">handle</span> <span class="o">=</span> <span class="nx">zend_objects_store_put</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="nx">foo_free_storage</span><span class="p">,</span> <span class="k">NULL</span> <span class="nx">TSRMLS</span>    <span class="nx">_CC</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">retval</span><span class="o">.</span><span class="nx">handlers</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">foo_object_handlers</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">retval</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Initialization</span>
</span><span class='line'><span class="nx">PHP_MINIT_FUNCTION</span><span class="p">(</span><span class="nx">bar</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">zend_class_entry</span> <span class="nx">ce</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">INIT_CLASS_ENTRY</span><span class="p">(</span><span class="nx">ce</span><span class="p">,</span> <span class="s2">&quot;Foo&quot;</span><span class="p">,</span> <span class="nx">foo_functions</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">foo_ce</span> <span class="o">=</span> <span class="nx">zend_register_internal_class</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ce</span> <span class="nx">TSRMLS_CC</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">foo_ce</span><span class="o">-&gt;</span><span class="na">create_object</span> <span class="o">=</span> <span class="nx">foo_create_handler</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">foo_object_handlers</span><span class="p">,</span> <span class="nx">zend_get_std_object_handlers</span><span class="p">(),</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nx">zend_object</span>    <span class="nx">_handlers</span><span class="p">));</span>
</span><span class='line'>  <span class="nx">foo_object_handlers</span><span class="o">.</span><span class="nx">clone_obj</span> <span class="o">=</span> <span class="k">NULL</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">SUCCESS</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>My development enviromnment is as listed below.</p>

<ul>
<li>CentOS [x86_64]</li>
<li>gcc 4.4.7</li>
</ul>


<p>Could someone lets me know the solution of this problem?
If someone has any advice to me, please inform <a href="https://twitter.com/Lewuathe">@Lewuathe</a>.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Actor Model With Node Cluster]]></title>
    <link href="http://lewuathe.github.io/blog/2014/03/01/actor-model-with-node-cluster/"/>
    <updated>2014-03-01T02:19:34+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/03/01/actor-model-with-node-cluster</id>
    <content type="html"><![CDATA[<p>If you want to implement asynchronous parallel system with nodejs, the best and easiest way might be using <a href="http://nodejs.org/api/cluster.html">cluster</a>.
Cluster module is easy to use and provides you faster implementation. I wrote somewhat Actor like code that uses cluster module.</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">cluster</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Get the number of core of your CPU</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">numCPUs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">).</span><span class="nx">cpus</span><span class="p">().</span><span class="nx">length</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">cluster</span><span class="p">.</span><span class="nx">isWorker</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Starting worker process</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;I am worker &quot;</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Send master process a message</span>
</span><span class='line'>    <span class="nx">process</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="nx">chat</span><span class="o">:</span> <span class="s2">&quot;I am + &quot;</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span> <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Event handler that is called when this worker get a message</span>
</span><span class='line'>    <span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Thank you receiving: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">chat</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nx">cluster</span><span class="p">.</span><span class="nx">isMaster</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Starting master process</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span> <span class="nx">numCPUs</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">){</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Create worker process</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">worker</span> <span class="o">=</span> <span class="nx">cluster</span><span class="p">.</span><span class="nx">fork</span><span class="p">();</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;worker forked: pid=&quot;</span> <span class="o">+</span> <span class="nx">worker</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Catch the timing of worker death</span>
</span><span class='line'>        <span class="nx">worker</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;death&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">worker</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;worker &#39;</span> <span class="o">+</span> <span class="nx">worker</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">pid</span> <span class="o">+</span> <span class="s1">&#39; died&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Event hander that is called when the master get a message</span>
</span><span class='line'>        <span class="nx">worker</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;master received: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">chat</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">worker</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="nx">chat</span><span class="o">:</span> <span class="s1">&#39;Hi, I received: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">chat</span><span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// In order to kill all process, you shouldn&#39; forget below part</span>
</span><span class='line'><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;SIGINT&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">cluster</span><span class="p">.</span><span class="nx">isMaster</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;master is killed: pid=&#39;</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;worker is killed pid=&#39;</span> <span class="o">+</span> <span class="nx">process</span><span class="p">.</span><span class="nx">pid</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>With cluster, there are two types of actors. One is master process, and the others are worker processes.
You can let master process and worker process send message respectively. To sending worker a message from master,
use <code>worker.send({text:"From master to worker"})</code>. On the other hand to sending master a message from worker process,
use <code>process.send({text:"From worker to master"})</code>.</p>

<p>This asynchronous model looks like Actor and message model. In this model, it is not necessary to implement exclusive control
because all processes acts harmoniously with only messages. If I can take this model nicely into nodejs, <a href="https://github.com/Lewuathe/n42">n42</a>
will get better running performance. I&rsquo;ll try it.</p>

<p>Thank you</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tokyo Node Gakuen 11th Period]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/27/tokyo-node-gakuen-11th-period/"/>
    <updated>2014-02-27T21:34:24+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/27/tokyo-node-gakuen-11th-period</id>
    <content type="html"><![CDATA[<p>Yesterday, I took part in <a href="http://connpass.com/event/5071/">Tokyo Node Gakuen 11th period</a> for the first time.
Though I want to attend this meeting to be a node hacker for a long time, I have not been able to get a chance to do so.
About two weeks ago, I semi-completed <a href="https://github.com/Lewuathe/n42">n42</a> that implements some deep learning algorithms,
stacked denoised autoencoder, deep belief network. So time has come, and I realized that I have something to tell and
where I can convey my passions through one software stack, nodejs.</p>

<!-- more -->


<h2><strong>Talk about the future of nodejs</strong></h2>

<p>Presented by <a href="https://twitter.com/yosuke_furukawa">@yosuke_furukawa</a>. He is the next representative of nodejs Japan community.
He is young and so vital, passionate that I believe that future of nodejs.jp must be bright. Please go for it!</p>

<div style="width: 65%;text-align:center;" markdown="1">
<script async class="speakerdeck-embed" data-id="a753718081010131e5751252e28d83c2" data-ratio="1.33333333333333" src="http://lewuathe.github.io//speakerdeck.com/assets/embed.js"></script>
</div>


<p>He introduced some new features of nodejs v0.12 and hot libraries supported by nodejs community such as <a href="http://koajs.com/">koa</a> (Official site is so cool!) and <a href="http://primus.io/">Primus</a>. These libraries were unfamiliar to me this time. So this introduction was good to me in order to understand the current situation of nodejs roughtly. Thank you.</p>

<h2><strong>Getting started browserify</strong></h2>

<p>Next presenter was <a href="https://twitter.com/hitsujiwool">@hitsujiwool</a>. He looks very familiar with client JavaScript technologies. Especially in this session, he talked about the overview of <a href="http://browserify.org/">browserify</a>. This tool converts the codes written in <a href="http://en.wikipedia.org/wiki/CommonJS">CommonJS</a> style into the executable code in web browser. I cannot understand easily at that time. And unfortunately, this situation does not change now.</p>

<div style="width: 65%;text-align:center;" markdown="1">
<script async class="speakerdeck-embed" data-id="d0609f0080f90131e5751252e28d83c2" data-ratio="1.29456384323641" src="http://lewuathe.github.io//speakerdeck.com/assets/embed.js"></script>
</div>


<p>However, roma was not built in a day. I understand sufficiently the necessity of study client JavaScript technology stacks and trend. So I won&rsquo;t lose this chance. Even if it takes some month, I have a desire to grasp the concept of this technology at last.</p>

<p>And below is LT session.</p>

<h2><strong>Deep learning with nodejs</strong></h2>

<p>This is my session. As I said previously, I developed deep learning module in nodejs called <a href="https://www.npmjs.org/package/n42">n42</a>. n42 was named after <a href="http://en.wikipedia.org/wiki/The_Hitchhiker's_Guide_to_the_Galaxy">The Hitchhiker&rsquo;s Guide to the Galaxy</a>. A super computer called &ldquo;deep thought&rdquo; enters in this movie. People asked one diffucult question to this computer bacause this computer is so smart that it can always answer any questions. The question was this.</p>

<blockquote><p>the Answer to the Ultimate Question of Life, the Universe, and Everything</p></blockquote>

<p>After 750million years, deep thought answered.</p>

<blockquote><p>42</p></blockquote>

<p>What? The answer of every thing is really only 42? I also doubt the validity of this answer, but I like this story very much. I want to see the day when n42 can give me the answer of everything :)</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/31651520" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px 1px 0; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/lewuathe/deeplearning-with-node" title="Deeplearning with node" target="_blank">Deeplearning with node</a> </strong> from <strong><a href="http://www.slideshare.net/lewuathe" target="_blank">Kai Sasaki</a></strong> </div></p>

<h2><strong>node.js as Gips for training asynchronous programming</strong></h2>

<p>I&rsquo;m afraid to say, but I could not find the presentation slide.
The presenter was <a href="https://twitter.com/niryuu">@niryuu</a>. His presentation was exciting.
The most impressive word I can remember is</p>

<blockquote><p>Do it properly</p></blockquote>

<p>Asynchronous programming in nodejs becomes sometimes very halmful such as callback hell.
He solved this problem simple concept. Return values properly. Using Primise etc.
These motivations had stimulated me to write code properly in any situation.
I feel that I can make use of this phrase when I was discouraged. Thank you.</p>

<h2><strong>With node.js, a novice programmer can make online fighting game easily</strong></h2>

<p>This session was given by <a href="https://twitter.com/pegass85">@pegass85</a>. He was so passionate that I enjoy his presentaion profoundly. He seems that he loves games very much. So he intruduced some games that released about a decade ago. Through his talking, I can feel that he really enjoy programming and games. It reminded me of the importance of enjoying programming as a hobbiest not a worker. I am looking forward the day when his game of &ldquo;paper, stone and scissors&rdquo; running properly online.</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/31621477" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px 1px 0; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/yuusuketakeuchi96/nodejs-31621477" title="Node.jsなら日曜プログラマーでも簡単に通信対戦ゲームが作れる" target="_blank">Node.jsなら日曜プログラマーでも簡単に通信対戦ゲームが作れる</a> </strong> from <strong><a href="http://www.slideshare.net/yuusuketakeuchi96" target="_blank">Yuusuke Takeuchi</a></strong> </div></p>

<h2>Last but not least</h2>

<p>Throught these sessions, I can see the potential of nodejs in a new light.
By the huge power of community, these softwares are given its futures.
I was forced to realize that fact by these passionate developers of nodejs.
The main theme of this seminor was</p>

<blockquote><p>Talk about the future of nodejs</p></blockquote>

<p>I have a desire of the bright future of nodejs when a lot of developers and users
make world better place helping each other with this software.
After meeting these passionate developers, this desire changed to confidence.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Optimize Octopress for Facebook Post]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/24/optimize-octopress-for-facebook-post/"/>
    <updated>2014-02-24T20:25:45+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/24/optimize-octopress-for-facebook-post</id>
    <content type="html"><![CDATA[<p>This blog made by <a href="http://octopress.org/">octopress</a>, ruby CMS tool.
As many others do, I also combined this tool with <a href="http://pages.github.com/">GitHub pages</a>
But this method has one fault about posting on facebook. Octopress doesn&rsquo;t include ogp properties as default. Ogp properties privide facebook meta information such as title, author, description and url. So without this meta information, you cannot get proper images when you write a post on facebook. In order to attach thumbtail image to your post, you have to write some configuration on octopress.</p>

<!-- more -->




<div style="text-align:center" markdown="1">
<img src="http://lewuathe.github.io/images/posts/2014-02-24-octopress-ogp/before.png" />
</div>


<h2>Write appid and locale</h2>

<p>Append below configuration in your <code>_config.yml</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>facebook_app_id: YOUR_APP_ID
</span><span class='line'>facebook_locale: ja_JP</span></code></pre></td></tr></table></div></figure>


<p>YOUR_APP_ID might be listed on <code>/source/_include/facebook_like.html</code> Paste that number.</p>

<h2>Change facebook like action</h2>

<p>Edit <code>/source/_include/facebook_like.html</code> like below. This modification makes this JavaScript code get app_id and locale from <code>_config.yml</code> file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>&lt;div id="fb-root"&gt;&lt;/div&gt;
</span><span class='line'>&lt;script&gt;(function(d, s, id) {
</span><span class='line'>  var js, fjs = d.getElementsByTagName(s)[0];
</span><span class='line'>  if (d.getElementById(id)) {return;}
</span><span class='line'>  js = d.createElement(s); js.id = id; js.async = true;
</span><span class='line'>  js.src = "//connect.facebook.net/ja_JP/all.js#appId=212934732101925&xfbml=1";
</span><span class='line'>  fjs.parentNode.insertBefore(js, fjs);
</span><span class='line'>}(document, 'script', 'facebook-jssdk'));&lt;/script&gt;
</span><span class='line'></span></code></pre></td></tr></table></div></figure>


<h2>Add top page flag</h2>

<p>To ditinguish post articles and top page, add this flag to <code>source/index.html</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>---
</span><span class='line'>layout: default
</span><span class='line'>index: true  
</span><span class='line'>---</span></code></pre></td></tr></table></div></figure>


<h2>Configuration for ogp meta informations</h2>

<p>Write below meta tags to <code>source/_includes/custom/facebook_ogp.html</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>% cat source/_includes/custom/facebook_ogp.html
</span><span class='line'>&lt;meta property="og:title" content="Optimize octopress for facebook post - The first cry of Atom" &gt;
</span><span class='line'>&lt;meta property="og:description" content="" /&gt;
</span><span class='line'>&lt;meta property="og:url" content="http://lewuathe.com" /&gt;
</span><span class='line'>&lt;meta property="og:image" content="http://lewuathe.github.io/images/site_image.png" /&gt;
</span><span class='line'>&lt;meta property="og:author" content="lewuathe" /&gt;
</span><span class='line'>&lt;meta property="og:site_name" content="The first cry of Atom" /&gt;
</span><span class='line'>&lt;meta property="og:locale" content="ja_JP" /&gt;
</span><span class='line'>&lt;meta property="og:type" content="article" /&gt;
</span><span class='line'>&lt;meta property="fb:app_id" content="212934732101925" /&gt;</span></code></pre></td></tr></table></div></figure>


<h2>Include meta tags</h2>

<p>At last, make header include these meta tags. Write below on <code>source/_include/head.html</code></p>

<p><img src="http://lewuathe.github.io/images/posts/2014-02-24-octopress-ogp/code.png" /></p>

<p>So that&rsquo;s all. It&rsquo;s ok. Deploy this site and post any entry to facebook.</p>

<div style="text-align:center" markdown="1">
<img src="http://lewuathe.github.io/images/posts/2014-02-24-octopress-ogp/after.png" />
</div>


<p>Good, you can see your thumbnail. A research shows that the post that has thumbnail images attracts more people than
the post that has no image can. If you are using octopress for writing your own blog, it must be the good option for increasing
the access from facebook.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Trying Word2vec From Twitter Corpus]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/23/trying-word2vec-from-twitter-corpus/"/>
    <updated>2014-02-23T17:47:16+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/23/trying-word2vec-from-twitter-corpus</id>
    <content type="html"><![CDATA[<p>Do you know <a href="https://github.com/dav/word2vec">word2vec</a>? This library is one of the hottest module which provides an efficient implementation of the continuous bag-of-words and skip-gram architectures for computing vector representations of words.</p>

<p>Recently, my collegues told me what word2vec is. From that time, I want to try this library in some chance. This time, I trained this skip-gram model with twitter corpus.</p>

<!-- more -->


<h2>Install word2vec</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ git clone https://github.com/dav/word2vec.git</span></code></pre></td></tr></table></div></figure>


<p>There are demo scripts. Let me see demo-word.sh.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DATA_DIR=../data
</span><span class='line'>BIN_DIR=../bin
</span><span class='line'>SRC_DIR=../src
</span><span class='line'>
</span><span class='line'>TEXT_DATA=$DATA_DIR/text8
</span><span class='line'>VECTOR_DATA=$DATA_DIR/text8-vector.bin
</span><span class='line'>
</span><span class='line'>pushd ${SRC_DIR} && make; popd
</span><span class='line'>
</span><span class='line'>if [ ! -e $VECTOR_DATA ]; then
</span><span class='line'>  
</span><span class='line'>  if [ ! -e $TEXT_DATA ]; then
</span><span class='line'>    wget http://mattmahoney.net/dc/text8.zip -O $DATA_DIR/text8.gz
</span><span class='line'>    gzip -d $DATA_DIR/text8.gz -f
</span><span class='line'>  fi
</span><span class='line'>  echo -----------------------------------------------------------------------------------------------------
</span><span class='line'>  echo -- Training vectors...
</span><span class='line'>  time $BIN_DIR/word2vec -train $TEXT_DATA -output $VECTOR_DATA -cbow 0 -size 200 -window 5 -negative 0 -hs 1 -sample 1e-3 -threads 12 -binary 1
</span><span class='line'>  
</span><span class='line'>fi
</span><span class='line'>
</span><span class='line'>echo -----------------------------------------------------------------------------------------------------
</span><span class='line'>echo -- distance...
</span><span class='line'>
</span><span class='line'>$BIN_DIR/distance $DATA_DIR/$VECTOR_DATA</span></code></pre></td></tr></table></div></figure>


<p>The main part of demo is below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> time $BIN_DIR/word2vec -train $TEXT_DATA -output $VECTOR_DATA -cbow 0 -size 200 -window 5 -negative 0 -hs 1 -sample 1e-3 -threads 12 -binary 1</span></code></pre></td></tr></table></div></figure>


<p>I found that the only requirement of training data was morphological analyzed text. For example, below.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>病院
</span><span class='line'>の
</span><span class='line'>待合室
</span><span class='line'>に
</span><span class='line'>い
</span><span class='line'>たら
</span><span class='line'>隣
</span><span class='line'>の
</span><span class='line'>人
</span><span class='line'>が</span></code></pre></td></tr></table></div></figure>


<p>Then how can I make these corpus from twitter API?</p>

<h2>Making twitter corpus</h2>

<p>I wrote this script that access twiter search API. In version 1.1, public timeline API has been remove from service.
So you should make corpus from only twitter search API if you want to categorize by language type. Because only search API has
<code>lang</code> parameter.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># -*- coding: utf-8 -*-</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">os</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">twitter</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">yaml</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">TwitterSearch</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;./config.yml&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_lang</span> <span class="o">=</span> <span class="s">&#39;ja&#39;</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">_api</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span>
</span><span class='line'>            <span class="n">consumer_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="s">&quot;consumer_key&quot;</span><span class="p">],</span>
</span><span class='line'>            <span class="n">consumer_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="s">&quot;consumer_secret&quot;</span><span class="p">],</span>
</span><span class='line'>            <span class="n">access_token_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="s">&quot;access_token_key&quot;</span><span class="p">],</span>
</span><span class='line'>            <span class="n">access_token_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="p">[</span><span class="s">&quot;access_token_secret&quot;</span><span class="p">]</span>
</span><span class='line'>        <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
</span><span class='line'>        <span class="n">search_word</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>    <span class="c"># OK</span>
</span><span class='line'>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">term</span><span class="o">=</span><span class="n">search_word</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_lang</span><span class="p">)</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
</span><span class='line'>            <span class="n">text</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</span><span class='line'>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</span><span class='line'>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">words</span> <span class="o">=</span> <span class="s">u&#39;あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわをん&#39;</span>
</span><span class='line'>    <span class="n">t</span> <span class="o">=</span> <span class="n">TwitterSearch</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span><span class='line'>        <span class="n">t</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Each line has one tweet text. These texts are searched with japanese syllabary, &ldquo;あいうえお&hellip;&rdquo;
in order to make searching logic more simple. But there might be room for improvement in this part. If you want to create more complex search queries, change <code>words</code>.</p>

<p>This script makes such outputs.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">あ、猫話はあちら様の凛ちゃんの話です。うちの凛ちゃんは鮫なので。あしからず。</span>
</span><span class='line'><span class="err">あああ乱視＆鳥目でこの時間の外出全然見えないいいいいい</span>
</span><span class='line'><span class="err">お散歩に行きたくなりますね。あ、今日は猫さんの日なんですね！</span>
</span><span class='line'><span class="err">あぷりを、いんすとーーるしたぜ。</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Morphological analysis</h2>

<p>I used <a href="http://mecab.googlecode.com/svn/trunk/mecab/doc/index.html">MeCab</a> for the morphological analysis.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">$</span> <span class="n">mecab</span> <span class="n">row_text</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">morphological_output</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>This library generates below output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">病院</span>    <span class="err">名詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">病院</span><span class="p">,</span><span class="err">ビョウイン</span><span class="p">,</span><span class="err">ビョーイン</span>
</span><span class='line'><span class="err">の</span>      <span class="err">助詞</span><span class="p">,</span><span class="err">連体化</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">の</span><span class="p">,</span><span class="err">ノ</span><span class="p">,</span><span class="err">ノ</span>
</span><span class='line'><span class="err">待合室</span>  <span class="err">名詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">待合室</span><span class="p">,</span><span class="err">マチアイシツ</span><span class="p">,</span><span class="err">マチアイシツ</span>
</span><span class='line'><span class="err">に</span>      <span class="err">助詞</span><span class="p">,</span><span class="err">格助詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">に</span><span class="p">,</span><span class="err">ニ</span><span class="p">,</span><span class="err">ニ</span>
</span><span class='line'><span class="err">い</span>      <span class="err">動詞</span><span class="p">,</span><span class="err">自立</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">一段</span><span class="p">,</span><span class="err">連用形</span><span class="p">,</span><span class="err">いる</span><span class="p">,</span><span class="err">イ</span><span class="p">,</span><span class="err">イ</span>
</span><span class='line'><span class="err">たら</span>    <span class="err">助動詞</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">特殊・タ</span><span class="p">,</span><span class="err">仮定形</span><span class="p">,</span><span class="err">た</span><span class="p">,</span><span class="err">タラ</span><span class="p">,</span><span class="err">タラ</span>
</span><span class='line'><span class="err">隣</span>      <span class="err">名詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">隣</span><span class="p">,</span><span class="err">トナリ</span><span class="p">,</span><span class="err">トナリ</span>
</span><span class='line'><span class="err">の</span>      <span class="err">助詞</span><span class="p">,</span><span class="err">連体化</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">の</span><span class="p">,</span><span class="err">ノ</span><span class="p">,</span><span class="err">ノ</span>
</span><span class='line'><span class="err">人</span>      <span class="err">名詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">人</span><span class="p">,</span><span class="err">ヒト</span><span class="p">,</span><span class="err">ヒト</span>
</span><span class='line'><span class="err">が</span>      <span class="err">助詞</span><span class="p">,</span><span class="err">格助詞</span><span class="p">,</span><span class="err">一般</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">が</span><span class="p">,</span><span class="err">ガ</span><span class="p">,</span><span class="err">ガ</span>
</span><span class='line'><span class="err">「</span>      <span class="err">記号</span><span class="p">,</span><span class="err">括弧開</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">「</span><span class="p">,</span><span class="err">「</span><span class="p">,</span><span class="err">「</span>
</span><span class='line'><span class="err">あの</span>    <span class="err">連体詞</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="err">あの</span><span class="p">,</span><span class="err">アノ</span><span class="p">,</span><span class="err">アノ</span>
</span></code></pre></td></tr></table></div></figure>


<p>This outputs include a part of speech, and prununciations. So remove it with <code>awk</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">$</span> <span class="n">awk</span> <span class="s">&#39;{ print $1 }&#39;</span> <span class="o">&lt;</span> <span class="n">morphological_output</span><span class="o">.</span><span class="n">txt</span> <span class="o">&gt;</span> <span class="n">words</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="err">病院</span>
</span><span class='line'><span class="err">の</span>
</span><span class='line'><span class="err">待合室</span>
</span><span class='line'><span class="err">に</span>
</span><span class='line'><span class="err">い</span>
</span><span class='line'><span class="err">たら</span>
</span><span class='line'><span class="err">隣</span>
</span><span class='line'><span class="err">の</span>
</span><span class='line'><span class="err">人</span>
</span><span class='line'><span class="err">が</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok, now you can train skip-gram algorithm with this data.</p>

<h2>Training</h2>

<p>This is my training script.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">DATA_DIR</span><span class="o">=</span>../data
</span><span class='line'><span class="nv">BIN_DIR</span><span class="o">=</span>../bin
</span><span class='line'><span class="nv">SRC_DIR</span><span class="o">=</span>../src
</span><span class='line'>
</span><span class='line'><span class="nv">TEXT_DATA</span><span class="o">=</span><span class="nv">$DATA_DIR</span>/twitter_text
</span><span class='line'><span class="nv">VECTOR_DATA</span><span class="o">=</span><span class="nv">$DATA_DIR</span>/twitter_text-vector.bin
</span><span class='line'>
</span><span class='line'><span class="nb">pushd</span> <span class="k">${</span><span class="nv">SRC_DIR</span><span class="k">}</span> <span class="o">&amp;&amp;</span> make; <span class="nb">popd</span>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> -- Training vectors...
</span><span class='line'><span class="nb">time</span> <span class="nv">$BIN_DIR</span>/word2vec -train <span class="nv">$TEXT_DATA</span> -output <span class="nv">$VECTOR_DATA</span> -cbow 0 -size 200 -window 5 -negative 0 -hs 1 -sample 1e-3 -threads 12 -binary 1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">echo</span> -----------------------------------------------------------------------------------------------------
</span><span class='line'><span class="nb">echo</span> -- distance...
</span><span class='line'>
</span><span class='line'><span class="nv">$BIN_DIR</span>/distance <span class="nv">$DATA_DIR</span>/<span class="nv">$VECTOR_DATA</span>
</span></code></pre></td></tr></table></div></figure>


<p>It is the almost same script to <code>demo-word.sh</code>.</p>

<p>Training takes about 3 seconds. It is very short time. (But it means there are not enough training data) :(</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>% ./twitter-script.sh
</span><span class='line'>~/Dropbox/MyWorks/algos/word2vec/src ~/Dropbox/MyWorks/algos/word2vec/scripts
</span><span class='line'>gcc word2vec.c -o ../bin/word2vec -lm -pthread -O2 -Wall -funroll-loops
</span><span class='line'>gcc word2phrase.c -o ../bin/word2phrase -lm -pthread -O2 -Wall -funroll-loops
</span><span class='line'>gcc distance.c -o ../bin/distance -lm -pthread -O2 -Wall -funroll-loops
</span><span class='line'>gcc word-analogy.c -o ../bin/word-analogy -lm -pthread -O2 -Wall -funroll-loops
</span><span class='line'>gcc compute-accuracy.c -o ../bin/compute-accuracy -lm -pthread -O2 -Wall -funroll-loops
</span><span class='line'>chmod +x ../scripts/*.sh
</span><span class='line'>~/Dropbox/MyWorks/algos/word2vec/scripts
</span><span class='line'>-- Training vectors...
</span><span class='line'>Starting training using file ../data/twitter_text
</span><span class='line'>Vocab size: 1516
</span><span class='line'>Words in train file: 50979
</span><span class='line'>
</span><span class='line'>real    0m0.734s
</span><span class='line'>user    0m1.822s
</span><span class='line'>sys     0m0.076s
</span><span class='line'>-----------------------------------------------------------------------------------------------------
</span><span class='line'>-- distance...
</span><span class='line'>Enter word or sentence <span class="o">(</span>EXIT to <span class="nb">break</span><span class="o">)</span>:
</span></code></pre></td></tr></table></div></figure>


<p>Enter some words.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>Enter word or sentence <span class="o">(</span>EXIT to <span class="nb">break</span><span class="o">)</span>:  病院
</span><span class='line'>                                              Word       Cosine distance
</span><span class='line'>------------------------------------------------------------------------
</span><span class='line'>                                               ぶ               0.991685
</span><span class='line'>                                            ソチ                0.990486
</span><span class='line'>                                            bottle              0.989918
</span><span class='line'>                                            点滴                0.988539
</span></code></pre></td></tr></table></div></figure>


<p>Word &ldquo;病院&rdquo; means hostpital. The forth word that has near vector to hospital is &ldquo;点滴&rdquo;, an intravenous drip. It looks like word2vec working nice, however other data are irrelevant to hospital. That&rsquo;s too bad.</p>

<p>In addition to this error, cosine distance of all data are above 0.98. These distance points suggest word2vec cannot make sound model with this training data.
Unfortunately, there are also a lot of words that has no counterpart in training data. In many cases, target words that you want to investigate are not included in this model.
You cannot make use of  this model with such a tiny data extracted from twitter API in practical situation.</p>

<h2>Next</h2>

<p>Next time, I want to try with Wikipedia JP corpus. This famous site includes huge corpus data. I am sure to obtain good results in the next time.</p>

<p>Source codes used this process is <a href="https://github.com/Lewuathe/algos/tree/master/word2vec">here</a>. Please do take a look at these codes!</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Use JavaScriptInterface on Android]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/21/use-javascriptinterface-on-android/"/>
    <updated>2014-02-21T21:34:20+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/21/use-javascriptinterface-on-android</id>
    <content type="html"><![CDATA[<p>On Android, there is a system for calling Java method from JavaScript. This is called <a href="http://developer.android.com/reference/android/webkit/JavascriptInterface.html">JavaScriptInterface</a>.
With this class, you can call Java methods run on Android application from JavaScript written on any HTML file.</p>

<p>If you want, you can write good user interface with HTML and JavaScript. And backend logic can be written by Java, Android SDK.
So this is the potential way to write Android application. Today I&rsquo;d like to introduce this way.</p>

<!-- more -->


<h2>Attach WebView</h2>

<p>In order to render HTML, you need to use <a href="http://developer.android.com/reference/android/webkit/WebView.html">WebView</a>.
So first of all, attach WebView to your layout file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span class='line'><span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
</span><span class='line'>              <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span>
</span><span class='line'>              <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
</span><span class='line'>              <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;WebView</span>
</span><span class='line'>            <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>            <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
</span><span class='line'>            <span class="na">android:id=</span><span class="s">&quot;@+id/webView&quot;</span>
</span><span class='line'>          <span class="na">android:layout_gravity=</span><span class="s">&quot;center_horizontal&quot;</span><span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/LinearLayout&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Write you HTML</h2>

<p>On previous WebView renders this html file. You need to write this file on your project directory so that an application can use it
from bundle files. My Sample looks like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>JSTest<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Call Java&quot;</span> <span class="na">onclick=</span><span class="s">&quot;JSAction.action()&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>JSAction</code> is the Java class that implements JavaScriptInterface with annotation.
So last let&rsquo;s write down this interface class.</p>

<h2>Write JavaScriptInterface class</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyActivity</span> <span class="kd">extends</span> <span class="n">Activity</span> <span class="o">{</span>
</span><span class='line'>    <span class="cm">/**</span>
</span><span class='line'><span class="cm">     * Called when the activity is first created.</span>
</span><span class='line'><span class="cm">     */</span>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>        <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">WebView</span> <span class="n">webView</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">webView</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webView</span><span class="o">.</span><span class="na">setWebViewClient</span><span class="o">(</span><span class="k">new</span> <span class="n">WebViewClient</span><span class="o">());</span>
</span><span class='line'>        <span class="n">WebSettings</span> <span class="n">settings</span> <span class="o">=</span> <span class="n">webView</span><span class="o">.</span><span class="na">getSettings</span><span class="o">();</span>
</span><span class='line'>        <span class="n">settings</span><span class="o">.</span><span class="na">setJavaScriptEnabled</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">webView</span><span class="o">.</span><span class="na">addJavascriptInterface</span><span class="o">(</span><span class="k">new</span> <span class="n">JavaScriptAction</span><span class="o">(),</span> <span class="s">&quot;JSAction&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">webView</span><span class="o">.</span><span class="na">loadUrl</span><span class="o">(</span><span class="s">&quot;file:///android_asset/jstest.html&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// This is the JavaScriptInterface class</span>
</span><span class='line'>  <span class="c1">// All you need to do is write annotation for JavaScriptInterface. </span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaScriptAction</span> <span class="o">{</span>
</span><span class='line'>        <span class="nd">@JavascriptInterface</span>
</span><span class='line'>        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">action</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Toast</span><span class="o">.</span><span class="na">makeText</span><span class="o">(</span><span class="n">MyActivity</span><span class="o">.</span><span class="na">this</span><span class="o">,</span>
</span><span class='line'>                         <span class="s">&quot;Called from JavaScript&quot;</span><span class="o">,</span>
</span><span class='line'>                         <span class="n">Toast</span><span class="o">.</span><span class="na">LENGTH_SHORT</span><span class="o">).</span><span class="na">show</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="http://lewuathe.github.io/images/posts/2014-02-21-javascriptinterface-android/demo.png" alt="demo" /></p>

<p>That&rsquo;s all. When you click input button, a toast will show on screen.
By using JavaScriptInterface, you can easily separate UI design and business logic.
Definitely, this will be the useful option for your development.</p>

<p>If you want to look into the detail of these code, please access <a href="https://github.com/Lewuathe/JavaScriptInterface-sample">here</a>
This is my sample repository. I&rsquo;m glad to see this repository is used for further development.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android SDK on IntelliJ IDEA]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/20/android-sdk-on-intellij-idea/"/>
    <updated>2014-02-20T21:24:56+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/20/android-sdk-on-intellij-idea</id>
    <content type="html"><![CDATA[<p>Eventually, I finished android lecture that is introduced on <a href="http://lewuathe.com/blog/2014/02/18/useful-shortcuts-for-intellij-idea/">previous post</a>
In this lecture, I learned how to use <a href="https://www.eclipse.org/">Eclipse</a>, <a href="http://java.com/ja/">Java</a> and of course <a href="http://developer.android.com/sdk/index.html">Android SDK</a></p>

<p>After coming home, I tried to creating a environent for android application development. However only installing Eclipse and creating same environment to lectures one
makes me tired. So I create this environment with <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a>.</p>

<!-- more -->


<p>I use IntelliJ IDEA community edition because it is free. Until now I don&rsquo;t think there is any lack of function with community edition</p>

<h2>Install IntelliJ IDEA</h2>

<p>From <a href="http://www.jetbrains.com/idea/">this page</a>, download IntelliJ IDEA community edition. Follow the instructions of wizard. Done!</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-02-20-androidsdk-with-intellijidea/intellijidea-ce.png" alt="android project" /></p>

<h2>Install Android SDK</h2>

<p>From <a href="http://dl.google.com/android/android-sdk_r22.2.1-macosx.zip">here</a>, download android SDK. But there is one thing to pay attention. You don&rsquo;t have to install ADT bundler version, bacause this package includes Eclipse and its plugins. With IntelliJ IDEA, these are not necessary to install.</p>

<p>And then, unzip this package. Put <code>android-sdk-macosx</code> on any directory. For example, I put on my home directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>~/android-sdk-macosx</span></code></pre></td></tr></table></div></figure>


<p>Run android package manager, and install requires packages.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ cd ~/android-sdk-macosx
</span><span class='line'>$ ./android-sdk-macosx/tools/android</span></code></pre></td></tr></table></div></figure>


<h2>Create project</h2>

<p>Select android application module project.</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-02-20-androidsdk-with-intellijidea/android-project.png" alt="android project" /></p>

<p>And select android SDK version that you installed previously. In this capture, I selected API version 19.</p>

<p><img src="http://lewuathe.github.io/images/posts/2014-02-20-androidsdk-with-intellijidea/android-sdk.png" alt="android project" /></p>

<p>It is very easy, isn&rsquo;t it?</p>

<p>But unfortunately, android simulator is no more faster :(</p>

<p>I pray for the faster android emulator to Google.</p>

<p>Thank you :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Useful Shortcuts for IntelliJ IDEA]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/18/useful-shortcuts-for-intellij-idea/"/>
    <updated>2014-02-18T21:21:10+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/18/useful-shortcuts-for-intellij-idea</id>
    <content type="html"><![CDATA[<p>In this week, I am attending a lecture for developing mobile application on android.
Of course I had no experience writing android applications, I have not written Java code in my life.
Through this lecture, I was so impressed by the functionality of <a href="https://www.eclipse.org/">Eclipse</a>.</p>

<p>In my life, I hate using IDE because these tools always hide a mechanism for building application.
This is why I always used emacs or vim. But today, I changed my mind. IDE is the next step for me in order to acquire new skills.
So just now I installed <a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> which is in fashion nowadays.</p>

<!-- more -->


<p>In this post, I&rsquo;d like to introduce some shortcuts for my kickstarting IntelliJ IDEA. If you know any other tips, please let me know.</p>

<table>
<thead>
<tr>
<th></th>
<th align="left"> Short Cut </th>
<th align="left"> Function </th>
<th align="left"> Notes </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td align="left"> Ctrl + Space  </td>
<td align="left"> Basic Code completion </td>
<td align="left"> With IntelliJ IDEA, however code completion is run automatically </td>
</tr>
<tr>
<td></td>
<td align="left"> Alt + Enter   </td>
<td align="left"> Show intention actions and quick-fixes </td>
<td align="left"> IntelliJ IDEA gives me any suggestions in each situations </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + Alt + L </td>
<td align="left"> Reformat code </td>
<td align="left"> Rearrange for readable format </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + Alt + O </td>
<td align="left"> Optimize imports </td>
<td align="left"> Remove unnecessary imports </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + Q </td>
<td align="left"> Quick documentation </td>
<td align="left"> Simple reference to javadoc </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + O </td>
<td align="left"> Override methods </td>
<td align="left"> Implements override methods of current class </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + / </td>
<td align="left"> Comment out/in a line </td>
<td></td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + W </td>
<td align="left"> Select successively increasing code blocks </td>
<td align="left"> You can select a meaningful code blocks </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + Y </td>
<td align="left"> Delete line at caret </td>
<td></td>
</tr>
<tr>
<td></td>
<td align="left"> Shift + Enter </td>
<td align="left"> Start new line </td>
<td align="left"> Wherever line you are, insert new line</td>
</tr>
<tr>
<td></td>
<td align="left"> Shift + F10 </td>
<td align="left"> Run </td>
<td align="left"> </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + Alt + V </td>
<td align="left"> Introduce variables </td>
<td align="left"> Make variables name automatically </td>
</tr>
<tr>
<td></td>
<td align="left"> Ctrl + J </td>
<td align="left"> Insert live templates </td>
<td align="left"> A lot of type of templates are preinstalled </td>
</tr>
</tbody>
</table>


<p>How do you think that? Of course, there are so many shortcuts and functions that I cannot introduce all of these.
The only way to know how useful IntelliJ IDEA is using it throughly! From today, I&rsquo;ll switch default editor to IntelliJ IDEA.</p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Go and Scala, Which Should I Use?]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/17/go-and-scala-which-should-i-use/"/>
    <updated>2014-02-17T22:37:59+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/17/go-and-scala-which-should-i-use</id>
    <content type="html"><![CDATA[<p>Today, <a href="http://www.google.com/trends/explore#q=golang%2C%20clojure&amp;cmpt=q">Go and Clojure compete with each other</a>. <a href="http://golang.org/">Go</a> will be one of the
hottest programming language in this year. This is the compiler language which can be seen as the successor C++.</p>

<p>On the other hand, <a href="http://www.scala-lang.org/">Scala</a> is the successor of Java which succeeded blending two programming paradigms, object-oriented programming and
functional programming.</p>

<!-- more -->


<p>These two languages are very similar to me. In developing deep learning module for myself, which language should I use?
Or if I can ask more general question, which language will be the major static language in the field in which tough performance
and maintainability are required. If you have any good idea or criteria for selecting these two languages, please send good advice to <a href="https://twitter.com/Lewuathe">@Lewuathe</a></p>

<p>Thank you.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Yes, You Are Malala]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/15/yes-you-are-malala/"/>
    <updated>2014-02-15T21:56:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/15/yes-you-are-malala</id>
    <content type="html"><![CDATA[<p><meta property=”og:image” content=”/images/posts/2014-02-14-you-are-malala/malala.jpg” /></p>

<div style="text-align:center" markdown="1">
<img src="http://lewuathe.github.io/images/posts/2014-02-14-you-are-malala/malala.jpg" />
</div>


<p>We, Japanese have built high level democratic society. We have an universal suffrage system,
the rights to discuss through a lot of type media, and the constitution which guarantees our liberty of expression.
The end of the Edo era, we have kept to build these system gradually, sometimes destructively.
So, yes. We are one of the most democratic citizens in the world.</p>

<!-- more -->


<p>In Japan, it is difficult to see a lot of destructive tragedies which are occured around the world as reality.</p>

<p>So, Malala teaches me that education is not the gift fallen from the heaven, but the achivements by our continuous
efforts. This book showed me that our country, our politics, our society were not just obtained. We cannot take it for granted
getting the benefit from these system by the fight in the past.</p>

<p>However, I think that fights against something and efforts for something are often mistook as similar things. But it is not true.</p>

<h2>Don&rsquo;t stand up with Sword</h2>

<p>Malala said</p>

<blockquote><p>The pen is mighter than the sword</p></blockquote>

<p>Democracy system is supported by education system itself. If all citizens are blind to politics, economy
,science and so on, democracy will be malfunctional. In order to keep the sound democrary system, we have to
be well educated. These two statement cannot be divided. We all have to get an our own pen respectively.</p>

<p>However, I feel that we start forgetting the importance of the pen. Alternatively, we are reviewing the value of
sword which destroys our country completely in the past. People stands up with their sword.</p>

<h2>No Fight, Do Read</h2>

<p>We, Japanese people, are industrious people. We used to like studying for just enrich our life, and our community.
With enourmous knowledge and experience, we tackled a lot of problems which made an attack to our community.</p>

<p>But I think, people become tired of these line of trial which continues to our child, and those child and eternally.</p>

<p>Our weapon, called education seems helpless now. Our effort to make the better future of our community resulted in
Lost Decade in Japan, suicide of thousands people. There are now a few children and a lot of old people in Japan.
In conclusion of our hope and effort after world war 2, we find our community has become unsustainable, hopeless society.</p>

<p>We realized that a pen can no longer help us. We need to pick up new weapon to fight against new era. <strong>Sword</strong></p>

<h2>Duty of those who tackle problematic future</h2>

<p>Once a girl was groan under opression because she cannot get the chance of education freely.
Violence, destruction disturbed her studying. But she kept studying not only for herself but also her community.
She might think education made all people free from coercion through democracy system with the power of education.
This must have been the most peaceful, hopeful community that she and all around people ever seen.</p>

<p>The pen was her hope.</p>

<p>So suppose we are the future figure of her hope. As I said at the beginning, Japan has full democracy and education system.
This might be the figure she desires as the future of her country.</p>

<h2>Another distress</h2>

<p>But this is what happen. People start to pick up sword.</p>

<p>What will she think about when she knows that ideal democracy society turns their policy to pick up their sword?</p>

<p>Is this the future desired by her people?</p>

<p>All the people will be defeated by the fact the education cannot overcome violence
which distresses her for a long time, and hopelessness cover herself.</p>

<h2>Our future is not for only ourselves</h2>

<p>Malala said at the United nation. She felt that when she was shoot.</p>

<blockquote><p>Weakness,fear and hopelessness died,
Strength,power and courage was born</p></blockquote>

<p>If there are enemis against us, it must be our mind which forces us stop thinking, and pick up an old sword used many times over.
This is the future we must avoid for our world. The hope is not the time of defeating the enemies, even solving all problems.
It is in the range of long span we can keep our education, and democracy. We have to retain our pens for our world.</p>

<p>Don&rsquo;t stop thinking. I cannot say where there are any answers for us, but I can say not these are not in violence, destructions. These are past things
we experienced over and over again. Now it&rsquo;s the time to build our community for only future, not past. For a pen, not a sword.</p>

<p>Believe in the power of education and democracy. <em>You are Malala in Japan, the future of world democracy</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NN With Nodejs]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/14/nn-with-nodejs/"/>
    <updated>2014-02-14T22:23:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/14/nn-with-nodejs</id>
    <content type="html"><![CDATA[<p>2 layer newral network is added to <a href="https://github.com/Lewuathe/n42">n42</a>
This network is simple newral network which can trained throught gradient descent optimization calculation.
It is the same algorithm to the one of denoised autoencoder used by n42. So implementation itself was not diffucult.
The code is showed below.</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *   Training weight parameters with supervised learning</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *   @method train</span>
</span><span class='line'><span class="cm"> *   @param  lr {float}  learning rate</span>
</span><span class='line'><span class="cm"> *   @param  input {Matrix} input data (option)</span>
</span><span class='line'><span class="cm"> *   @param  label {Matrix} label data (option)</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'><span class="nx">NN</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">train</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lr</span><span class="p">,</span> <span class="nx">input</span><span class="p">,</span> <span class="nx">label</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">x</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">input</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">input</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">input</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="p">(</span><span class="nx">label</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">label</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">label</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c1">// Get hidden layer value</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getHiddenValues</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// The output of this network</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getOutput</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// The error of output layer. </span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lH2</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">label</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Restortion to the error of each hidden layer unit</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">sigma</span> <span class="o">=</span> <span class="nx">lH2</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W2</span><span class="p">.</span><span class="nx">transpose</span><span class="p">());</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lH1</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sigma</span><span class="p">.</span><span class="nx">rows</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">lH1</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">sigma</span><span class="p">.</span><span class="nx">cols</span><span class="p">();</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">lH1</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">sigma</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">y</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">y</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Make sylvester matrix</span>
</span><span class='line'>    <span class="nx">lH1</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">(</span><span class="nx">lH1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// lW1 is the weight matrix from input layer to hidden layer</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lW1</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">lH1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// lW2 is the weight matrix from hidden layer to output layer</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lW2</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">lH2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Add gradient to weight matrix respectively</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W1</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">W1</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">lW1</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W2</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">W2</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">lW2</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// vBias is the input layer bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">lH2</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// hBias is the hidden layer bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">lH1</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Trying.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">nn</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NN</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">label</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 0.1 is learning rate</span>
</span><span class='line'>  <span class="nx">nn</span><span class="p">.</span><span class="nx">train</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">nn</span><span class="p">.</span><span class="nx">predict</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</span><span class='line'><span class="c1">// [0.9999597224429988, 0.000040673558435336644]</span>
</span><span class='line'><span class="c1">// [0.0000455181928397141, 0.9999544455271699]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Activation function</h2>

<p>This prediction seems rather good, but the activation function was changed to sigmoid function, not softmax function in this case. In the multi class categorizing problem, soft max function usually used to predict. But I can get good result with sigmoid function rather than softmax function. With softmax function, the result is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// [0.5242635012777253, 0.47573649872227464]</span>
</span><span class='line'><span class="c1">// [0.2690006890629063, 0.7309993109370937]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Further trying</h2>

<p>Umm, this is not the result I want to get. I can&rsquo;t grasp why the result is not correct sufficiently.
I want to keep tracking whether there are any problems in my program.
And with this network, I want to try kaggle mnist problem. Now n42 is run to train mnist data. It takes a lot of time.
If any good result is obtained through this process, I will introduce this blog. Welcome feedback, thank you!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Restricted Boltzmann Machine in Node]]></title>
    <link href="http://lewuathe.github.io/blog/2014/02/05/restricted-boltzmann-machine-in-node/"/>
    <updated>2014-02-05T21:18:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/02/05/restricted-boltzmann-machine-in-node</id>
    <content type="html"><![CDATA[<p>n42 has restricted boltzmann machine. Restricted boltzmann machine is a kind of
autoencoder in order to extract charasteristics. In this article, I would leave out
the detail of restricted boltzmann machine. I want to introduce how the RBM is written
in node.</p>

<!-- more -->




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *  Restricted Boltzmann machine</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  @module n42</span>
</span><span class='line'><span class="cm"> *  @class  RBM</span>
</span><span class='line'><span class="cm"> *  @author Kai Sasaki</span>
</span><span class='line'><span class="cm"> *  @since 2014/01/28</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">Matrix</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sylvester&#39;</span><span class="p">).</span><span class="nx">Matrix</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Vector</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sylvester&#39;</span><span class="p">).</span><span class="nx">Vector</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">utils</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./utils.js&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">binomial</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;binomial-sampling&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">generator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;box-muller&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">RBM</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">nVisible</span><span class="p">,</span> <span class="nx">nHidden</span><span class="p">,</span> <span class="nx">W</span><span class="p">,</span> <span class="nx">hBias</span><span class="p">,</span> <span class="nx">vBias</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="nx">input</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">nVisible</span> <span class="o">=</span> <span class="nx">nVisible</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">nHidden</span>  <span class="o">=</span> <span class="nx">nHidden</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize weight parameter</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">W</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">W</span> <span class="o">:</span> <span class="nx">Matrix</span><span class="p">.</span><span class="nx">Random</span><span class="p">(</span><span class="nx">nVisible</span><span class="p">,</span> <span class="nx">nHidden</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize hidden bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hBias</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">hBias</span> <span class="o">:</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Zero</span><span class="p">(</span><span class="nx">nHidden</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize visual bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span> <span class="o">=</span> <span class="p">(</span><span class="nx">vBias</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">vBias</span> <span class="o">:</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Zero</span><span class="p">(</span><span class="nx">nVisible</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">contrastiveDivergence</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lr</span><span class="p">,</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">input</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">input</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">ph</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">sampleHGivenV</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">input</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Select phSample</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">chainStart</span> <span class="o">=</span> <span class="nx">ph</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// stepRet[0] v1Means</span>
</span><span class='line'>    <span class="c1">// stepRet[1] v1Samples</span>
</span><span class='line'>    <span class="c1">// stepRet[2] h1Means</span>
</span><span class='line'>    <span class="c1">// stepRet[3] h1Sample</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">step</span> <span class="o">&lt;</span> <span class="nx">k</span><span class="p">;</span> <span class="nx">step</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stepRet</span><span class="p">;</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">stepRet</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">gibbsHvh</span><span class="p">(</span><span class="nx">chainStart</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Select a nhSample</span>
</span><span class='line'>            <span class="nx">stepRet</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">gibbsHvh</span><span class="p">(</span><span class="nx">stepRet</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// W += lr * (W.T * phSample - nvSample.T * nhMeans)</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">witem1</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">ph</span><span class="p">[</span><span class="mi">1</span><span class="p">]).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">witem2</span> <span class="o">=</span> <span class="nx">stepRet</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">stepRet</span><span class="p">[</span><span class="mi">2</span><span class="p">]).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">witem1</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">witem2</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">vitem1</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">input</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">vitem2</span> <span class="o">=</span> <span class="nx">stepRet</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">vitem1</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">vitem2</span><span class="p">),</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">hitem1</span> <span class="o">=</span> <span class="nx">ph</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">hitem2</span> <span class="o">=</span> <span class="nx">stepRet</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">hitem1</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">hitem2</span><span class="p">),</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sampleHGivenV</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v0Sample</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">h1Means</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">propup</span><span class="p">(</span><span class="nx">v0Sample</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">h1Sample</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">h1Means</span><span class="p">.</span><span class="nx">rows</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">h1Sample</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">h1Means</span><span class="p">.</span><span class="nx">cols</span><span class="p">();</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">h1Sample</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">h1Means</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
</span><span class='line'>            <span class="c1">//h1Sample[i].push(generator() + h1Means.e(i+1, j+1));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">h1Sample</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">(</span><span class="nx">h1Sample</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nx">h1Means</span><span class="p">,</span> <span class="nx">h1Sample</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sampleVGivenH</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h0Sample</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">v1Means</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">propdown</span><span class="p">(</span><span class="nx">h0Sample</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">v1Sample</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v1Means</span><span class="p">.</span><span class="nx">rows</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">v1Sample</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">v1Means</span><span class="p">.</span><span class="nx">cols</span><span class="p">();</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">v1Sample</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">binomial</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">v1Means</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
</span><span class='line'>            <span class="c1">//v1Sample[i].push(generator()*0.01 + v1Means.e(i+1, j+1))</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">v1Sample</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">(</span><span class="nx">v1Sample</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nx">v1Means</span><span class="p">,</span> <span class="nx">v1Sample</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">gibbsHvh</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h0Sample</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">retV1</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">sampleVGivenH</span><span class="p">(</span><span class="nx">h0Sample</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// Given h1Sample == retV1[1]</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">retH1</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">sampleHGivenV</span><span class="p">(</span><span class="nx">retV1</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class='line'>    <span class="k">return</span> <span class="p">[</span><span class="nx">retV1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">retV1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">retH1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">retH1</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">preSigmoidActivation</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">preSigmoidActivation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">propdown</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">preSigmoidActivation</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">transpose</span><span class="p">()),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">preSigmoidActivation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">RBM</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reconstruct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">));</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">reconstructedV</span> <span class="o">=</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">transpose</span><span class="p">()),</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">));</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">reconstructedV</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">RBM</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Though I completed to write, this autoencoder has not yet enough accuracy to prediction in compared to
denoised autoencoder. So I have to pile up some improvements to use practically.
If you find any bugs, welcome patches!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Stacked Denoised Autoencoder With Nodejs]]></title>
    <link href="http://lewuathe.github.io/blog/2014/01/29/stacked-denoised-autoencoder-with-nodejs/"/>
    <updated>2014-01-29T21:38:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/01/29/stacked-denoised-autoencoder-with-nodejs</id>
    <content type="html"><![CDATA[<p>I developed deep leanring module which enables you to use stacked denoised autoencoder in nodejs.
This is called n42. You can train with deep learning algorithm very easily.</p>

<p><a href="https://npmjs.org/package/n42">https://npmjs.org/package/n42</a></p>

<!-- more -->


<h2>How to use</h2>

<p>This is how to use it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">n42</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;n42&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// input data</span>
</span><span class='line'><span class="c1">// This is made of sylvester matrix</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// label data</span>
</span><span class='line'><span class="c1">// This is made of sylvester matrix</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">sda</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">n42</span><span class="p">.</span><span class="nx">SdA</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Training all hidden layers</span>
</span><span class='line'><span class="nx">sda</span><span class="p">.</span><span class="nx">pretrain</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Tuning output layer which is composed of logistics regression</span>
</span><span class='line'><span class="nx">sda</span><span class="p">.</span><span class="nx">finetune</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Test data</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">([</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>    <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
</span><span class='line'><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sda</span><span class="p">.</span><span class="nx">predict</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/**</span>
</span><span class='line'><span class="cm"> *   Predict answers</span>
</span><span class='line'><span class="cm"> *   [0.9999998973561728, 1.0264382721184357e-7] ~ [1.0, 0.0]</span>
</span><span class='line'><span class="cm"> *   [4.672230837774381e-28, 1]                  ~ [0.0, 1.0]  </span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you want to know what stacked denoised autoencoder is, look this <a href="http://deeplearning.net/tutorial/SdA.html">page</a>
Briefly, stacked denoised autoencoder is multi layer denoised autoencoder.</p>

<p>First you should train denoised autoencoder by
unsupervised learning. With this process, this network can extract characteristics of input data properly.</p>

<p>Second, you tune output logistics regression layer with gradient descent.</p>

<p>And Last, only predict! It&rsquo;s easy, isn&rsquo;t it?</p>

<p>Now the accuracy is depend on the parameters which you select considerably. Deep leanring algorithm might be the way it is,
however, I want to develop end implement more general algorithms. In the next step, I&rsquo;ll develop restricted boltzmann machine, and
deep boltzmann machine. Thouhgh these algorithms are somewhat less accurate than stacked denoised autoencoder, n42 must have this algorithm
for own diversity, and the number of options.</p>

<h2>Last&hellip;</h2>

<p>And the last but not least, if you find any bugs or any points to be fixed, patches are welcome!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Autoencoder With node.js]]></title>
    <link href="http://lewuathe.github.io/blog/2014/01/26/autoencoder-with-node-dot-js/"/>
    <updated>2014-01-26T21:14:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/01/26/autoencoder-with-node-dot-js</id>
    <content type="html"><![CDATA[<p><a href="https://en.wikipedia.org/wiki/Autoencoder">Auto encoder</a> is used for deep learning. Auto encoder extract characteristics of data through
unsupervised learning. This is a kind of newral network. By using an auto encoder, you don&rsquo;t have to
be in trouble with choicing extracting algorithm, or doing yourself. Therefore, in deepleanring field,
this algorithm is used very actively. There are many implementation such as Python or Java, which are
used in machine learning frequently, but I cannot find this in nodejs. So this weekend, I wrote autoencoder in nodejs.</p>

<!-- more -->


<p>When I started writing this code, I referred <a href="https://github.com/yusugomori/DeepLearning">@yusugomori/DeepLearning</a>.
I would like to take this opportunity to express my appreciation and gratitude to him for his great code.</p>

<p><a href="https://github.com/Lewuathe/n42/blob/master/lib/dA.js">GitHub source</a></p>

<p>The major linear algebra library is <a href="http://sylvester.jcoglan.com/">sylvelster</a> in JavaScript. This is simple and user friendly
library. So if you cannot decide which library you should use in JavaScript, I recommend sylvester.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">Matrix</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sylvester&#39;</span><span class="p">).</span><span class="nx">Matrix</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Vector</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sylvester&#39;</span><span class="p">).</span><span class="nx">Vector</span><span class="p">;</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">utils</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./utils.js&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">);</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">generator</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;box-muller&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">dA</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">nVisible</span><span class="p">,</span> <span class="nx">nHidden</span><span class="p">,</span> <span class="nx">W</span><span class="p">,</span> <span class="nx">hBias</span><span class="p">,</span> <span class="nx">vBias</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">input</span>    <span class="o">=</span> <span class="nx">input</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">nVisible</span> <span class="o">=</span> <span class="nx">nVisible</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">nHidden</span>  <span class="o">=</span> <span class="nx">nHidden</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// Initialize weight parameter</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W</span>     <span class="o">=</span> <span class="p">(</span><span class="nx">W</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">W</span> <span class="o">:</span> <span class="nx">Matrix</span><span class="p">.</span><span class="nx">Random</span><span class="p">(</span><span class="nx">nVisible</span><span class="p">,</span> <span class="nx">nHidden</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize hidden bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span> <span class="o">=</span> <span class="p">(</span><span class="nx">hBias</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">hBias</span> <span class="o">:</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Zero</span><span class="p">(</span><span class="nx">nHidden</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Initialize visual bias parameters</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span> <span class="o">=</span> <span class="p">(</span><span class="nx">vBias</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">vBias</span> <span class="o">:</span> <span class="nx">Vector</span><span class="p">.</span><span class="nx">Zero</span><span class="p">(</span><span class="nx">nVisible</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">wPrime</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">transpose</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dA</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCorruptedInput</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">corruptionLevel</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// Return noised data</span>
</span><span class='line'>    <span class="nx">assert</span><span class="p">.</span><span class="nx">isTrue</span><span class="p">(</span><span class="nx">corruptionLevel</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">noised</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">rows</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">noised</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">input</span><span class="p">.</span><span class="nx">cols</span><span class="p">();</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">// generator returns sampling value according to regular gaussian distribution</span>
</span><span class='line'>            <span class="nx">noised</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">((</span><span class="nx">generator</span><span class="p">()</span> <span class="o">*</span> <span class="nx">corruptionLevel</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="nx">input</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">));;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">$M</span><span class="p">(</span><span class="nx">noised</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dA</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHiddenValues</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// Calculate plus weight</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">rowValues</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">rowValues</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dA</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getReconstructedInput</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hidden</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">rowValues</span> <span class="o">=</span> <span class="nx">hidden</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">transpose</span><span class="p">());</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">sigmoid</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">plusBias</span><span class="p">(</span><span class="nx">rowValues</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">dA</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">train</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lr</span><span class="p">,</span> <span class="nx">corruptionLevel</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">input</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span><span class="o">?</span> <span class="nx">input</span> <span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">input</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
</span><span class='line'>    <span class="c1">// Noised data</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">tildeX</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getCorruptedInput</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">corruptionLevel</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getHiddenValues</span><span class="p">(</span><span class="nx">tildeX</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getReconstructedInput</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Below this line, backpropagation algorithm is used</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lH2</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">sigma</span> <span class="o">=</span> <span class="nx">lH2</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lH1</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">sigma</span><span class="p">.</span><span class="nx">rows</span><span class="p">();</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">lH1</span><span class="p">.</span><span class="nx">push</span><span class="p">([]);</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">sigma</span><span class="p">.</span><span class="nx">cols</span><span class="p">();</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">lH1</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">sigma</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">y</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">y</span><span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)));</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="nx">lH1</span> <span class="o">=</span> <span class="nx">$M</span><span class="p">(</span><span class="nx">lH1</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">lW</span> <span class="o">=</span> <span class="nx">tildeX</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">lH1</span><span class="p">).</span><span class="nx">add</span><span class="p">(</span><span class="nx">lH2</span><span class="p">.</span><span class="nx">transpose</span><span class="p">().</span><span class="nx">x</span><span class="p">(</span><span class="nx">y</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">W</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">W</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">lW</span><span class="p">.</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">vBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">lH2</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">hBias</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">utils</span><span class="p">.</span><span class="nx">mean</span><span class="p">(</span><span class="nx">lH1</span><span class="p">,</span> <span class="mi">0</span><span class="p">).</span><span class="nx">x</span><span class="p">(</span><span class="nx">lr</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nx">dA</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reconstruct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getHiddenValues</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">z</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">getReconstructedInput</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">z</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Traning and result</h2>

<p>Try auto encoder!!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'>            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
</span><span class='line'><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">da</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">dA</span><span class="p">(</span><span class="nx">$M</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// 0.1 is learning rate which is used gradient decent</span>
</span><span class='line'>    <span class="c1">// 0.02 is standard deviation which is used for add noise to original data</span>
</span><span class='line'>    <span class="nx">da</span><span class="p">.</span><span class="nx">train</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">da</span><span class="p">.</span><span class="nx">reconstruct</span><span class="p">(</span><span class="nx">$M</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]));</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*   </span>
</span><span class='line'><span class="cm"> *   Returns </span>
</span><span class='line'><span class="cm"> *   [0.5055820272991076, 0.9979837957439818, 0.007330556962859083]   </span>
</span><span class='line'><span class="cm"> *   [0.5042481334395964, 0.006342602394604374, 0.9970156469919944]</span>
</span><span class='line'><span class="cm"> *   [0.5055017563352926, 0.9979783271177022, 0.007473069891271281]</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>In general, this auto encoder looks like working properly. I think the error of difference between original data
and reconstructed data was induced by below two points.</p>

<ul>
<li>Lack of divergence of training data</li>
<li>Parameter tuning</li>
</ul>


<p>I didn&rsquo;t write many training examples. So in spite of many decent times, the parameters
cannot be updated properly. And I skipped parameter tuning completly :)</p>

<h2>Deep learning module</h2>

<p>I will make a deep learning module which uses this auto encoder. Please keep follow <a href="https://github.com/Lewuathe/n42">n42</a>!!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Idiomatic Python ~I Will Write With This Style~]]></title>
    <link href="http://lewuathe.github.io/blog/2014/01/21/idiomatic-mython/"/>
    <updated>2014-01-21T13:18:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/01/21/idiomatic-mython</id>
    <content type="html"><![CDATA[<p>I read a book, <em><a href="http://www.amazon.co.jp/Writing-Idiomatic-Python-2-7-3-Knupp-ebook/dp/B00B5KG0F8">Writing Idiomatic Python</a></em>
Although I usually write python codes, I have not paid attension to the style of these codes. By reading this book, I have noticed
that there are pythonic style in python codes. And I think it was good mind to write python code. There were many <em>Halmful</em>, <em>Idiomaric</em>
phrases about python code. So I&rsquo;d like to introduce some of them which I&rsquo;ll write in my own code.</p>

<!-- more -->


<p>And of course, all python developers should read this book!!</p>

<h2>Enumerate</h2>

<p>Usually, I write loop code like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'><span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="s">&quot;Nobita&quot;</span><span class="p">,</span> <span class="s">&quot;Masao&quot;</span><span class="p">]:</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">element</span><span class="p">))</span>
</span><span class='line'>    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>But it is harmful according to this book. Correctly, you should write like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">conteiner</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="s">&quot;Nobita&quot;</span><span class="p">,</span> <span class="s">&quot;Masao&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">element</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">conteiner</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Arbitrary arguments</h2>

<p>In python, you can write arbitrary arguments with <code>*args</code> or <code>**kwargs</code>. Arbutrary arguments are useful when you
want to implement some types of API which is different by package versions. You can write like below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">make_api_call</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span> <span class="n">a</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">b</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">c</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">args</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">kwargs</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">make_api_call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># --console--</span>
</span><span class='line'><span class="c"># 1</span>
</span><span class='line'><span class="c"># 2</span>
</span><span class='line'><span class="c"># 3</span>
</span><span class='line'><span class="c"># (4, 5, 6)</span>
</span><span class='line'><span class="c"># {&#39;age&#39;: 23, &#39;name&#39;: &#39;Takeshi&#39;}</span>
</span><span class='line'><span class="c">#</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Avoid <em>Swallowing</em> useful exceptions</h2>

<p>In python, <code>exception</code> is common phrases used in <code>for</code> loop or etc. In addition to this,
<code>exception</code> gives you a useful information for debugging. So you should not <em>swallow</em> these exceptions
by writing bare <code>except</code> clause. If you don&rsquo;t have any idea about what type exceptions are raised from
third-party library, you should raise it again.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_json_response</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
</span><span class='line'>    <span class="k">try</span><span class="p">:</span>
</span><span class='line'>        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span class='line'>    <span class="k">except</span><span class="p">:</span>
</span><span class='line'>        <span class="k">raise</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Avoid using a temporary variables with swapping</h2>

<p>Use tuple.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">foo</span> <span class="o">=</span> <span class="s">&quot;FOO&quot;</span>
</span><span class='line'><span class="n">bar</span> <span class="o">=</span> <span class="s">&quot;BAR&quot;</span>
</span><span class='line'><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Use <code>join</code> method. It&rsquo;s more faster</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">result_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="s">&quot;Nobita&quot;</span><span class="p">,</span> <span class="s">&quot;Masuo&quot;</span><span class="p">]</span>
</span><span class='line'><span class="n">reesult_string</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result_list</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Use format function to make a formatted string</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c"># user is a dictionary</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_formatted_user_info</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;Nama: {user.name}, Age: {user.age}, Sex: {user.sex}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Prefer <code>xrange</code> to <code>range</code></h2>

<p>Use <code>xrange</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="s">&#39;index: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Default value got from dicionary</h2>

<p>If there are <code>name</code> field in user, <code>get</code> returns <code>'Unknown'</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">username</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;Unknown&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Dictionary complehension</h2>

<p>The list complehension is well known about python context. But dictionary complehension is as important as this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">user_email</span> <span class="o">=</span> <span class="p">{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_list</span> <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Set complehension</h2>

<p>In set syntax, you can use complehension expression.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">users_first_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Ignore unnecessary row in tuple</h2>

<p>If there are any data which is not necessary for you in tuple, ignore it with <code>_</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_user_info</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'><span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;{name} can drink!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Generator</h2>

<p>Python list comprehension is very useful, however, processing very large list will run out of memory.
In this case you should use <code>generator</code> which is iterative expression, but doesn&rsquo;t use memory.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Nobita&quot;</span><span class="p">,</span> <span class="s">&quot;Takeshi&quot;</span><span class="p">,</span> <span class="s">&quot;Masuo&quot;</span><span class="p">]</span>
</span><span class='line'><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span> <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="s">&quot;Takeshi&quot;</span><span class="p">):</span>
</span><span class='line'>    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="c"># NOBITA</span>
</span><span class='line'><span class="c"># MASUO</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Refer PEP8</h2>

<p>Python has standard set of formatting rule officially. It is called <strong>PEP8</strong>.
You should install this plugin your editor.</p>

<h2>Write as PEP252</h2>

<p>PEP257 is the set of rules of document formattings.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">calculate_statistics</span><span class="p">(</span><span class="n">value_list</span><span class="p">):</span>
</span><span class='line'>    <span class="sd">&quot;&quot;&quot;Return a tuple containing the mean, median and the mode of a list of integers</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    Arguments:</span>
</span><span class='line'><span class="sd">    value_list -- a list of integer values</span>
</span><span class='line'>
</span><span class='line'><span class="sd">    &quot;&quot;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Last but not least</h1>

<p>I am a pythonia. With reading this book, I am able to write more pythonic code at my work scene.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Scrum Gathering Tokyo 2014]]></title>
    <link href="http://lewuathe.github.io/blog/2014/01/19/scrum-gathering-tokyo-2014-1/"/>
    <updated>2014-01-19T21:08:00+09:00</updated>
    <id>http://lewuathe.github.io/blog/2014/01/19/scrum-gathering-tokyo-2014-1</id>
    <content type="html"><![CDATA[<p>On January 14-15, I participated <strong><a href="http://scrumgatheringtokyo.org/2014/">Scrum Gathering Tokyo 2014</a></strong>.
Though this conference cost me a little more than I can afford it,
it was great time to me as scrum master in my project. I want to arrange
the contents of these sessions, but as there were many sessions it is hard to me.
So in this entry, I cite one scrum example after another which I heard in these sessions.</p>

<!-- more -->


<h1>Enterprise Scrum: the future management (Mike Beedle)</h1>

<h2>Rapid change in Business environment</h2>

<ul>
<li>Being and Becoming</li>
<li>The main incomes are from new products

<ul>
<li>About 70%</li>
</ul>
</li>
<li>Winner innovate faster</li>
<li>New product developemnt efficiency differences can be huge 1200%

<ul>
<li>That&rsquo;s why agile is needed in many companies</li>
</ul>
</li>
<li>The origin of scrum is TOYOTA production system</li>
<li>Scrum is applicable to business, generic and scaled techinics.</li>
</ul>


<h1>Leading the Lean</h1>

<ul>
<li>SAFe Roots

<ul>
<li><a href="http://www.scaledagileframework.com/">Scaled Agile framwwork</a></li>
</ul>
</li>
<li>In scrum class, any code cannot be written

<ul>
<li>The process which can be used in real scene should be progressed in code level.</li>
</ul>
</li>
</ul>


<h1>Padawan scrum master</h1>

<h2>First of all, let&rsquo;s study</h2>

<ul>
<li>Read <a href="http://www.amazon.co.jp/Estimating-Planning-Robert-Martin-Series/dp/0131479415%3FSubscriptionId%3DAKIAJCKXRISJS6UE36NQ%26tag%3Dkakutani-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D0131479415">Agile Estimating and Planning</a></li>
<li>Read <a href="http://www.amazon.co.jp/The-Agile-Samurai-Pragmatic-Programmers/dp/1934356581/ref=sr_1_1?s=english-books&amp;ie=UTF8&amp;qid=1390134825&amp;sr=1-1&amp;keywords=Agile+Samurai">Agile Samurai</a></li>
<li>In the past, XP is the main stream in SIer.

<ul>
<li>XP is the idealistic thought. So it is not fit the real scene.</li>
<li>On the halfway, the members are bored with the process.</li>
<li>In the team which is composed of about 70 members, the standard process or documents should be arranged precisely.</li>
</ul>
</li>
</ul>


<h2>And hearing clients about necessary conditions</h2>

<ul>
<li>Thinging of what to do</li>
<li>It might be difficult to do scrum in enterprise enviroment</li>
</ul>


<h2>How to estimate</h2>

<ul>
<li>Very roughtly.</li>
<li>Hour unit, 3 days unit.</li>
<li>From the beginning, chart is not burned down. Add tasks every day</li>
</ul>


<h2>How to do contractually</h2>

<ul>
<li>Introduce <a href="http://www.amazon.co.jp/%E3%83%8F%E3%82%A4%E3%83%96%E3%83%AA%E3%83%83%E3%83%89%E3%82%A2%E3%82%B8%E3%83%A3%E3%82%A4%E3%83%AB%E3%81%AE%E5%AE%9F%E8%B7%B5-%E8%8B%B1-%E7%B9%81%E9%9B%84/dp/4897979358">Hybrid scrum</a></li>
<li>It is seemed like waterfall from outside.

<ul>
<li>The process which need approvals shoule be done waterfall process</li>
</ul>
</li>
</ul>


<h2>In the case that there are anyone who is negative to agile scrum</h2>

<ul>
<li>Remove that member</li>
</ul>


<h2>How to cope with the change order</h2>

<ul>
<li>Require clients to line tasks by order, not attach the priority

<ul>
<li>If tasks are arranged one line, the order of task is explicit.</li>
</ul>
</li>
</ul>


<h2>Last but not least</h2>

<ul>
<li>Scrum should be changed to fit your own team</li>
<li>Some projects should be facilitated forcibly, like waterfall process</li>
</ul>

]]></content>
  </entry>
  
</feed>
